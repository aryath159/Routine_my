<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Routine & Mess Menu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .datetime {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .current-time {
            font-size: 1.1em;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
        }

        .icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .routine-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .time-slot {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .time-slot:hover {
            transform: translateY(-2px);
        }

        .time-slot.current {
            border-left-color: #ff6b6b;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
        }

        .time-slot h3 {
            font-size: 1em;
            margin-bottom: 8px;
            color: #667eea;
        }

        .time-slot.current h3 {
            color: white;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .meal-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 5px solid #667eea;
        }

        .meal-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }

        .meal-items {
            line-height: 1.6;
            color: #666;
        }

        .current-meal {
            border-top-color: #ff6b6b;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
        }

        .no-class {
            color: #999;
            font-style: italic;
        }

        .error {
            background: #ffe5e5;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #d63031;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .section {
                padding: 20px;
            }
            
            .routine-grid {
                grid-template-columns: 1fr;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÖ Daily Routine & Mess Menu</h1>
            <div class="datetime" id="currentDate"></div>
            <div class="current-time" id="currentTime"></div>
        </div>

        <div class="content">
            <div class="loading" id="loading">Loading your schedule and menu...</div>
            <div id="mainContent" style="display: none;">
                <div class="section">
                    <h2><span class="icon">üìö</span>Today's Class Schedule</h2>
                    <div class="routine-grid" id="routineGrid"></div>
                </div>

                <div class="section">
                    <h2><span class="icon">üçΩÔ∏è</span>Today's Mess Menu</h2>
                    <div class="menu-grid" id="menuGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class RoutineMenuApp {
            constructor() {
                this.routineData = null;
                this.menuData = null;
                this.currentDay = null;
                this.currentTime = null;
                this.init();
            }

            async init() {
                this.updateDateTime();
                setInterval(() => this.updateDateTime(), 1000);
                
                try {
                    await this.loadData();
                    this.renderContent();
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } catch (error) {
                    this.showError('Failed to load data: ' + error.message);
                }
            }

            updateDateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                
                document.getElementById('currentDate').textContent = 
                    now.toLocaleDateString('en-US', options);
                
                document.getElementById('currentTime').textContent = 
                    now.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });

                this.currentDay = now.toLocaleDateString('en-US', { weekday: 'long' });
                this.currentTime = now.getHours();
            }

            async loadData() {
                try {
                    // Load routine data
                    const routineResponse = await fetch('routine.csv');
                    const routineText = await routineResponse.text();
                    this.routineData = this.parseCSV(routineText);

                    // Load menu data
                    const menuResponse = await fetch('menu.csv');
                    const menuText = await menuResponse.text();
                    this.menuData = this.parseCSV(menuText);
                } catch (error) {
                    throw new Error('Could not load CSV files. Make sure routine.csv and menu.csv are in the same directory.');
                }
            }

            parseCSV(text) {
                const lines = text.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                const data = [];

                for (let i = 1; i < lines.length; i++) {
                    const values = this.parseCSVLine(lines[i]);
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }

                return { headers, data };
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim().replace(/"/g, ''));
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim().replace(/"/g, ''));
                return result;
            }

            renderContent() {
                this.renderRoutine();
                this.renderMenu();
            }

            renderRoutine() {
                const routineGrid = document.getElementById('routineGrid');
                const todayRoutine = this.routineData.data.find(row => 
                    row.Day.toLowerCase() === this.currentDay.toLowerCase()
                );

                if (!todayRoutine) {
                    routineGrid.innerHTML = '<div class="error">No routine found for today.</div>';
                    return;
                }

                const timeSlots = [
                    { time: '9:00 - 10:00', hour: 9 },
                    { time: '10:00 - 11:00', hour: 10 },
                    { time: '11:00 - 12:00', hour: 11 },
                    { time: '12:00 - 1:00', hour: 12 },
                    { time: '1:00 - 2:00', hour: 13 },
                    { time: '2:00 - 3:00', hour: 14 },
                    { time: '3:00 - 4:00', hour: 15 },
                    { time: '4:00 - 5:00', hour: 16 }
                ];

                routineGrid.innerHTML = '';

                timeSlots.forEach(slot => {
                    const subject = todayRoutine[slot.time] || 'Free';
                    const isCurrent = this.currentTime === slot.hour;
                    
                    const slotDiv = document.createElement('div');
                    slotDiv.className = `time-slot ${isCurrent ? 'current' : ''}`;
                    
                    slotDiv.innerHTML = `
                        <h3>${slot.time}</h3>
                        <div class="${subject.toLowerCase() === 'free' ? 'no-class' : ''}">${subject}</div>
                    `;
                    
                    routineGrid.appendChild(slotDiv);
                });
            }

            renderMenu() {
                const menuGrid = document.getElementById('menuGrid');
                const todayMenu = this.menuData.data.find(row => 
                    row['Column 1'] && row['Column 1'].toLowerCase().includes('breakfast')
                );

                if (!todayMenu) {
                    menuGrid.innerHTML = '<div class="error">No menu found for today.</div>';
                    return;
                }

                const meals = [
                    { name: 'Breakfast', time: [7, 8, 9], icon: 'üåÖ' },
                    { name: 'Lunch', time: [12, 13, 14], icon: '‚òÄÔ∏è' },
                    { name: 'Snacks', time: [16, 17], icon: '‚òï' },
                    { name: 'Dinner', time: [19, 20, 21], icon: 'üåô' }
                ];

                menuGrid.innerHTML = '';

                // Find the data for each meal type
                meals.forEach(meal => {
                    const mealData = this.menuData.data.find(row => 
                        row['Column 1'] && row['Column 1'].toLowerCase() === meal.name.toLowerCase()
                    );

                    if (mealData) {
                        const isCurrent = meal.time.includes(this.currentTime);
                        const todayMealItems = mealData[this.currentDay] || 'No menu available';
                        
                        const mealDiv = document.createElement('div');
                        mealDiv.className = `meal-card ${isCurrent ? 'current-meal' : ''}`;
                        
                        mealDiv.innerHTML = `
                            <h3>${meal.icon} ${meal.name}</h3>
                            <div class="meal-items">${this.formatMealItems(todayMealItems)}</div>
                        `;
                        
                        menuGrid.appendChild(mealDiv);
                    }
                });
            }

            formatMealItems(items) {
                if (!items || items === 'No menu available') {
                    return '<em>No menu available</em>';
                }
                
                // Split by comma and format each item
                return items.split(',').map(item => 
                    `‚Ä¢ ${item.trim()}`
                ).join('<br>');
            }

            showError(message) {
                document.getElementById('loading').innerHTML = `
                    <div class="error">${message}</div>
                `;
            }
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new RoutineMenuApp();
        });
    </script>
</body>
</html>
